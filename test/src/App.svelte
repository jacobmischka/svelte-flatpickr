<script>
	import Flatpickr from '../../src/Flatpickr.svelte';

	let value = undefined,
		formattedValue,
		flatpickr;

	let multiple = false;

	let options;
	$: options = {
		mode: 'range',
		defaultDate: ['2022-03-01', '2022-03-04'],
		enableTime: true,
		onChange(selectedDates, dateStr) {
			console.log('flatpickr hook', selectedDates, dateStr);
		},
		onOpen() {
			console.log('opened');
		},
	};

	$: console.log({ value, formattedValue });

	function handleOpen(event) {
		event.preventDefault();

		if (flatpickr) {
			flatpickr.open();
			flatpickr.calendarContainer.focus();
		}
	}

	function handleChange(event) {
		const [selectedDates, dateStr] = event.detail;
		console.log({ selectedDates, dateStr });
	}

	function handleClear() {
		if (flatpickr) {
			flatpickr.clear();
		}
	}

	function handleEmptyString() {
		value = "";
	}

	function handleSubmit(event) {
		event.preventDefault();

		console.log(event.target.elements['date'].value);
	}
</script>

<main>
	<form on:submit={handleSubmit}>
		<Flatpickr
			{options}
			bind:value
			bind:formattedValue
			on:change={handleChange}
			name="date"
			bind:flatpickr
			on:close={() => {
				console.log('closed');
			}}
			dateFormat="Y-m-d"
		/>

		<label>
			<input type="checkbox" bind:checked={multiple} />
			Multiple?
		</label>

		<button type="button" on:click={handleClear}>
			Clear
		</button>
		<button type="button" on:click={handleEmptyString}>
			Empty string
		</button>
		<button type="button" on:click={handleOpen}>
			Open picker
		</button>

		<button type="submit">
			Submit
		</button>
	</form>
</main>

<style>
	main {
		text-align: center;
		padding: 1em;
		margin: 0 auto;
	}
</style>
